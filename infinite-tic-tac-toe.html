<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinite Tic-Tac-Toe</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #f0f0f0;
        }
        .game-container {
            background: white;
            border: 2px solid #333;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 300px;
            width: 100%;
        }
        h3 {
            margin: 0 0 10px 0;
            position: relative;
        }
        .info-icon {
            position: absolute;
            top: 0;
            right: 0;
            cursor: pointer;
            font-size: 18px;
            user-select: none;
        }
        .info-panel {
            display: none;
            margin-bottom: 10px;
            text-align: left;
            font-size: 12px;
            line-height: 1.4;
        }
        .status {
            margin-bottom: 10px;
            font-weight: bold;
        }
        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
            margin-bottom: 10px;
            max-width: 240px;
            margin-left: auto;
            margin-right: auto;
        }
        .cell {
            aspect-ratio: 1;
            border: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            background: #f9f9f9;
            min-height: 60px;
        }
        .button-container {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .reset-btn, .toggle-btn {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid #333;
            border-radius: 5px;
            font-size: 16px;
        }
        .reset-btn {
            background: #ffcccc;
        }
        .toggle-btn {
            background: #e0e0e0;
        }
        @media (max-width: 480px) {
            .game-container {
                padding: 15px;
                max-width: 280px;
            }
            .cell {
                font-size: 20px;
                min-height: 50px;
            }
            .reset-btn, .toggle-btn {
                padding: 8px 16px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h3>Infinite Tic-Tac-Toe<span class="info-icon">‚Ñπ</span></h3>
        <div class="status">Player X's turn</div>
        <div class="info-panel">
            <strong>How to Play:</strong><br>
            ‚Ä¢ Players take turns placing X and O<br>
            ‚Ä¢ Get 3 in a row to win<br>
            ‚Ä¢ After 3 pieces, oldest/random piece disappears<br><br>
            <strong>Oldest Mode:</strong> First piece placed disappears<br>
            <strong>Random Mode:</strong> Random piece disappears (shown ghostly)
        </div>
        <div class="board"></div>
        <div class="button-container">
            <button class="reset-btn">Reset Game</button>
            <button class="toggle-btn">Mode: Oldest</button>
        </div>
    </div>

    <script>
        let board = [[null, null, null], [null, null, null], [null, null, null]];
        let moveHistory = [];
        let currentPlayer = 'X';
        let gameActive = true;
        let randomMode = false;
        let markedForRemoval = { X: null, O: null };
        let showInfo = false;

        const status = document.querySelector('.status');
        const boardElement = document.querySelector('.board');
        const resetBtn = document.querySelector('.reset-btn');
        const toggleBtn = document.querySelector('.toggle-btn');
        const infoIcon = document.querySelector('.info-icon');
        const infoPanel = document.querySelector('.info-panel');

        const cells = [];
        for (let i = 0; i < 9; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.addEventListener('click', () => handleMove(Math.floor(i / 3), i % 3));
            cells.push(cell);
            boardElement.appendChild(cell);
        }

        function handleMove(row, col) {
            if (!gameActive || board[row][col] !== null) return;

            const currentPlayerMoves = moveHistory.filter(m => m.player === currentPlayer);

            if (currentPlayerMoves.length >= 3) {
                const moveToRemove = randomMode ? 
                    markedForRemoval[currentPlayer] || currentPlayerMoves[Math.floor(Math.random() * currentPlayerMoves.length)] :
                    currentPlayerMoves[0];
                board[moveToRemove.row][moveToRemove.col] = null;
                moveHistory.splice(moveHistory.indexOf(moveToRemove), 1);
                markedForRemoval[currentPlayer] = null;
            }

            board[row][col] = currentPlayer;
            moveHistory.push({ player: currentPlayer, row, col });

            // Mark random piece for removal when player has 3 pieces in random mode
            if (randomMode) {
                const otherPlayer = currentPlayer === 'X' ? 'O' : 'X';
                const otherPlayerMoves = moveHistory.filter(m => m.player === otherPlayer);
                if (otherPlayerMoves.length >= 3 && !markedForRemoval[otherPlayer]) {
                    markedForRemoval[otherPlayer] = otherPlayerMoves[Math.floor(Math.random() * otherPlayerMoves.length)];
                }
            }

            if (checkForWin(currentPlayer)) {
                status.textContent = `üéâ Player ${currentPlayer} wins! üéâ`;
                gameActive = false;
                resetBtn.style.background = '#ccffcc';
            } else {
                currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
                status.textContent = `Player ${currentPlayer}'s turn`;
            }

            updateBoard();
        }

        function checkForWin(player) {
            const lines = [
                [[0,0],[0,1],[0,2]], [[1,0],[1,1],[1,2]], [[2,0],[2,1],[2,2]],
                [[0,0],[1,0],[2,0]], [[0,1],[1,1],[2,1]], [[0,2],[1,2],[2,2]],
                [[0,0],[1,1],[2,2]], [[0,2],[1,1],[2,0]]
            ];

            for (const line of lines) {
                const [a, b, c] = line;
                if (board[a[0]][a[1]] === player && 
                    board[b[0]][b[1]] === player && 
                    board[c[0]][c[1]] === player) {
                    [a, b, c].forEach(([row, col]) => {
                        const cellIndex = row * 3 + col;
                        cells[cellIndex].style.background = '#ffd700';
                        cells[cellIndex].style.boxShadow = '0 0 10px #ffd700';
                        cells[cellIndex].style.opacity = '0.7';
                    });
                    return true;
                }
            }
            return false;
        }

        function updateBoard() {
            cells.forEach((cell, i) => {
                const row = Math.floor(i / 3);
                const col = i % 3;
                const player = board[row][col];
                cell.textContent = player || '';
                
                if (cell.style.background !== 'rgb(255, 215, 0)') {
                    if (player === 'X') {
                        cell.style.background = randomMode ? '#ccffcc' : '#cce7ff';
                        cell.style.color = randomMode ? '#006600' : '#003d7a';
                    } else if (player === 'O') {
                        cell.style.background = randomMode ? '#e6ccff' : '#ffcccc';
                        cell.style.color = randomMode ? '#6600cc' : '#cc0000';
                    } else {
                        cell.style.background = '#f9f9f9';
                        cell.style.color = '#000';
                    }
                }
                
                if (gameActive) {
                    const isMarkedForRemoval = randomMode && 
                        markedForRemoval[player] && 
                        markedForRemoval[player].row === row && 
                        markedForRemoval[player].col === col;
                    
                    const isOldest = !randomMode && player && 
                        moveHistory.filter(m => m.player === player).length >= 3 &&
                        moveHistory.filter(m => m.player === player)[0].row === row &&
                        moveHistory.filter(m => m.player === player)[0].col === col;
                    
                    cell.style.opacity = (isMarkedForRemoval || isOldest) ? '0.4' : '1';
                } else {
                    cell.style.opacity = '1';
                }
            });
        }

        function resetGame() {
            board = [[null, null, null], [null, null, null], [null, null, null]];
            moveHistory = [];
            currentPlayer = 'X';
            gameActive = true;
            markedForRemoval = { X: null, O: null };
            status.textContent = "Player X's turn";
            resetBtn.style.background = '#ffcccc';
            
            cells.forEach(cell => {
                cell.style.background = '#f9f9f9';
                cell.style.boxShadow = 'none';
                cell.style.opacity = '1';
            });
            
            updateBoard();
        }

        resetBtn.addEventListener('click', resetGame);
        toggleBtn.addEventListener('click', () => {
            randomMode = !randomMode;
            toggleBtn.textContent = randomMode ? 'Mode: Random' : 'Mode: Oldest';
            markedForRemoval = { X: null, O: null };
            
            // Mark pieces for removal in random mode
            if (randomMode) {
                ['X', 'O'].forEach(player => {
                    const playerMoves = moveHistory.filter(m => m.player === player);
                    if (playerMoves.length >= 3) {
                        markedForRemoval[player] = playerMoves[Math.floor(Math.random() * playerMoves.length)];
                    }
                });
            }
            
            updateBoard();
        });
        infoIcon.addEventListener('click', () => {
            showInfo = !showInfo;
            infoIcon.textContent = showInfo ? '‚ùå' : '‚Ñπ';
            infoPanel.style.display = showInfo ? 'block' : 'none';
            boardElement.style.display = showInfo ? 'none' : 'grid';
        });
        updateBoard();
    </script>
</body>
</html>
